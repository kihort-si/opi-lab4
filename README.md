# opi-4

## Задание

1. Для своей программы из [лабораторной работы #3](https://se.ifmo.ru/courses/web#lab3) по дисциплине __"Веб-программирование"__ реализовать:
    - `MBean`, считающий общее число установленных пользователем точек, а также число точек, попадающих в область. В случае, если количество установленных пользователем точек стало кратно 10, разработанный `MBean` должен отправлять оповещение об этом событии.
    - `MBean`, определяющий площадь получившейся фигуры.
2. С помощью утилиты `JConsole` провести мониторинг программы:
    - Снять показания `MBean`-классов, разработанных в ходе выполнения *задания 1*.
    - Определить количество классов, загруженных в JVM в процессе выполнения программы.
3. С помощью утилиты `VisualVM` провести мониторинг и профилирование программы:
    - Снять график изменения показаний `MBean`-классов, разработанных в ходе выполнения *задания 1*, с течением времени.
    - Определить **имя класса, объекты которого занимают наибольший объём памяти JVM**; определить пользовательский класс, в экземплярах которого находятся эти объекты.
4. С помощью утилиты `VisualVM` и профилировщика `IDE NetBeans`, `Eclipse` или `Idea` локализовать и устранить проблемы с производительностью в [программе](https://se.ifmo.ru/documents/10180/189115/HttpUnit.tar.gz/7bf1032e-d16e-be85-c71b-dbe73c0178ba?t=1651168887037&download=true). По результатам локализации и устранения проблемы необходимо **составить отчёт**, в котором должна содержаться следующая информация:
    - Описание выявленной проблемы.
    - Описание путей устранения выявленной проблемы.
    - Подробное (со скриншотами) описание алгоритма действий, который позволил выявить и локализовать проблему.

Студент должен обеспечить возможность воспроизведения процесса поиска и локализации проблемы по требованию преподавателя.


## Выполнение
Это всё работает только локально!!!

### Задание 2
Часть1
1. Запускаем wildfly
2. Пишем в терминал `jconsole`
3. Выбираем процесс как-то связанный с wildfly (jboss-modules)
4. Заходим в MBeans -> org.viacheslav.beans

Часть2
1. Откройте вкладку MBeans.
2. Найдите раздел:
   java.lang → ClassLoading
   Параметры:
   - LoadedClassCount — текущее количество загруженных классов.
   - TotalLoadedClassCount — общее число классов, загруженных за время работы JVM.
   - UnloadedClassCount — количество выгруженных классов.

### Задание 3

Часть 1

1. Установить visualVM (скачать с https://visualvm.github.io/download.html и запускать /bin/visualvm или .exe)
2. Перейдите во вкладку MBeans.
3. Найдите ваш MBean (например, com.example:type=AppMonitoring).
4. Откройте атрибуты (например, status).
5. Для снятия графика:
   - Нажмите правой кнопкой на атрибут → Chart. (у меня почему-то не работает)
   - VisualVM начнет записывать значения в реальном времени.

Часть 2

Через вкладку "Monitor"
1. Перейдите во вкладку Monitor.
2. Нажмите Heap Dump (создаст слепок памяти).
3. После генерации кучи откройте вкладку Classes и отсортируйте по Size.

Через вкладку "Sampler"
1. Перейдите во вкладку Sampler.
2. Нажмите Memory → Start.
3. Сортируйте классы по Bytes или Instances.

Если в топе системные классы (например, byte[] или String), нужно найти пользовательский класс, который их удерживает.

1. В Heap Dump найдите системный класс (например, byte[]).
2. Нажмите правой кнопкой → Find References или Show Nearest GC Root.
3. VisualVM покажет цепочку ссылок до корневого объекта. Ищите классы из вашего приложения

